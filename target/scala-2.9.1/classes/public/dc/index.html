<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    	<link rel="stylesheet" type="text/css" href="dc.css"/>
    	<link rel="stylesheet" type="text/css" href="bootstrap.css"/>
		<script type="text/javascript" src="d3.v2.js"></script>
		<script type="text/javascript" src="crossfilter.js"></script>
		<script type="text/javascript" src="dc.js"></script>
		<script type="text/javascript" src="jquery.js"></script>
		<script type="text/javascript" src="splitter.js"></script>
		<script type="text/javascript" src="sgatools.graphics.js"></script>
		<script type="text/javascript" src="bootstrap.min.js"></script>
		
		
	</head>
	
	<body>
		<div class="container" style="width:1000px">
		<div class="well" style="margin-top:20px">
			<h4>Options:</h4>
			<select>
				<option>Plate 1</option>
				<option>Plate 2</option>
			</select>
			<div class="btn-group" style="display:inline">
                <button class="btn btn-primary dropdown-toggle" data-toggle="dropdown">Export heatmap <span class="caret"></span></button>
                <ul class="dropdown-menu">
                	<li><a href="#">Export as SVG</a></li>
                	<li><a href="#">Export as PNG</a></li>
                	<li><a href="#">Export as PDF</a></li>
                </ul>
            </div>
            
            <br>Heatmap color selection<br> heatmap upper and lower 
		</div>
		
		<div id="heatmap" class="" style="overflow:auto;"></div>
		<hr>
		<div id="chart-container" >
			<div id="bar-chart" style="margin-left:100;margin-right:100">
		    	<div id="data-count">
		    		<span class="filter-count"></span> selected out of <span class="total-count"></span></div>
		    		&nbsp;<a class="reset" href="javascript:barChart.filterAll();dc.redrawAll();" style="display:none;">reset</a>
		    	</div>
		    	
		    </div>
		    <table style="margin-left:100;margin-right:100;width:800" id="data-table" class="table table-hover">
			    <thead><tr class="row"><th>Row</th><th>Col</th><th>Query</th><th>Array</th><th>Score</th></tr>
			    </thead>
		    </table>
		    
		</div>
		<script>
		//dataName, plid, divChart, divDataTable, maxDataRows, chartWidth, chartHeight
		//drawBarChart("sgadata2.csv", "30874" ,"#bar-chart", "#data-table", 10, 600, 200);
		var barChart = drawBarChart({
			'dataName' : "sgadata2.csv",
			'selectedPlateId' : "30847", 
			'divChart' : "#bar-chart", 
			'divDataTable' : "#data-table", 
			'divDataCount' : "#data-count",
			'maxDataRows' : 50, 
			'chartWidth' : 800, 
			'chartHeight' : 200
		});		
		
		</script>
		
		<script type="text/javascript">
			//expression value label
			var expLab = d3.select("body")
			.append('div')
			.style('position','absolute')
			.style('background','#FFF')
			.style('opacity',0.9)
			.style('top',0)
			.style('padding',10)
			.style('left',40)
			.style('box-shadow', '2px 2px 2px 2px #8b8b8b')//Adjust for cross browser later
			.style('display','none');
			
			var rowNest, colNest;
			
			d3.csv('sgadata.csv', function(sgadata){
				   //height of each row in the heatmap
				   //width of each column in the heatmap
				   var gridSize = 13,
				   h = gridSize,
				   w = gridSize;
				   
				   var colorLow = 'red', colorMed = 'black', colorHigh = 'green';
				   
				   
				   rowNest = d3.nest().key(function(d) { return d.row; }).entries(sgadata);
				   colNest = d3.nest().key(function(d) { return d.col; }).entries(sgadata);
				   var nRows = rowNest.length,
					   nCols = colNest.length;
				   
				   var width = (gridSize * nCols)+50,
				   height = (gridSize * nRows)+50;
				   
				   //Empty heatmap
				   $('#heatmap').empty()
				   
				   var colorScale = d3.scale.linear()
				   .domain([-1, 0, 1])
				   .range([colorLow, colorMed, colorHigh]);
				   
				   var svg = d3.select("#heatmap").append("center").append("svg")
				   .attr("width", width)
				   .attr("height", height)
				   .attr("style", "margin-left:auto; margin-right:auto;display:block")
				   .append("g");
				   
				   var heatMap = svg.selectAll(".heatmap")
				   .data(sgadata, function(d) { return d.row-1 + ':' + d.col-1; })
				   .enter().append("svg:rect")
				   .attr("x", function(d) { return (d.col-1) * w; })
				   .attr("y", function(d) { return (d.row-1) * h; })
				   .attr("width", function(d) { return w; })
				   .attr("height", function(d) { return h; })
				   .attr("style", "shape-rendering: crispEdges;")
				   .style("fill", function(d) { return isNaN(+d.score) ? 'gray' : colorScale(d.score); });
				   				   
				   var rowLabel = svg.selectAll(".rowLabel")
				   .data(rowNest)
				   .enter().append('svg:text')
				   .attr('x', gridSize * nCols + 5)
				   .attr('y', function(d,i) { return ((i+.75) * gridSize) ;})
				   .attr('class','label')
				   .attr("text-anchor", "start")
				   .text(function(d) {return d.key;});
				   
				   var columnLabel = svg.selectAll(".colLabel")
				   .data(colNest)
				   .enter().append('svg:text')
				   .attr('x', function(d,i) {return ((i+0.4) * w);})
				   .attr('y', gridSize * nRows + 7)
				   .attr('class','label')
				   .style('text-anchor','start')
				   .attr("transform", function(d, i) {
						return "rotate(90 " + ((i + 0.4) * w) + ","+(gridSize * nRows + 7)+")"; })
				   .text(function(d) {return d.key;});
				   
				   heatMap
				   .on('mousemove', function(d) {
					   d3.select(this)
					   .attr('stroke-width',2)
					   .attr('stroke','yellow')
					   
					   output = d.row+ ' and '+ d.col +'<br>'+d.score;
					   
					   var x = window.event.clientX;
					   var y = window.event.clientY;
					   expLab
					   .style('top',y + 10)
					   .style('left',x + 10)
					   .style('display','block')
					   .html(output);
					   })
				   .on('mouseout', function(d,i) {
						d3.select(this)
						.attr('stroke-width',0)
						.attr('stroke','none')
						expLab
						.style('display','none')
					});
   
			});
			
		</script>
		
		<script>
			
		</script>
	</body>
</html>